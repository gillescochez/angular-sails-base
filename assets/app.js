!function(){"use strict";var a={"abstract":{}},b={"abstract":{}},c={},d={},e={};e.access=function(a,b,c){a.$on("$locationChangeStart",function(){var a=c.getUserType();a||b.path("/login")})},e.access.$inject=["$rootScope","$location","session","constants"],e.app=function(){var a=-1!==window.location.href.indexOf("localhost"),b="app",c=["ngRoute","ngCookies","ui.bootstrap",b+".controllers",b+".directives",b+".services"],d={protocol:"http",domain:"__DOMAIN_NAME__",port:"80"};return a&&(d.domain="localhost",d.port="1337"),{name:b,server:d,modules:c,getServerUrl:function(){return(d.protocol?d.protocol:"http")+"://"+d.domain+(d.port?":"+d.port:"")}}}(),e.routes=function(a,b){b.defaults.useXDomain=!0,a.when("/login",{templateUrl:"partials/login.html",controller:"login"}),a.when("/dashboard",{templateUrl:"partials/dashboard.html",controller:"dashboard"}),e.routes.api(a,"users"),a.otherwise({redirectTo:"/dashboard"})},e.routes.api=function(a,b,c){var d={list:"partials/section/list.html",view:"partials/section/view.html",edit:"partials/section/edit.html",create:"partials/section/edit.html",remove:"partials/section/remove.html"};angular.extend(d,c),a.when("/"+b,{templateUrl:d.list,controller:b}),a.when("/"+b+"/view/:id",{templateUrl:d.view,controller:b}),a.when("/"+b+"/edit/:id",{templateUrl:d.edit,controller:b,data:{user_type:1}}),a.when("/"+b+"/create",{templateUrl:d.create,controller:b,data:{user_type:1}}),a.when("/"+b+"/remove/:id",{templateUrl:d.remove,controller:b,data:{user_type:1}})},e.routes.$inject=["$routeProvider","$httpProvider"],a["abstract"].create=function(b,c,d,e,f,g){function h(a){var b;for(b in a)"select"===a[b].value&&a[b].provider&&i(a[b],b)}function i(a,c){a.provider.getAll().success(function(a){b.types[c].options=j(a)}).error(console.error)}function j(a){var b={};return a.forEach(function(a){b[a.id]=a.title||a.name||"not found"}),b}a["abstract"].init(b,d,e,g),c.$broadcast("breadcrumb:add",{label:g.name,path:"/"+g.name}),c.$broadcast("breadcrumb:add",{label:"Add"}),b.save={label:e.fetch("create"),handler:function(){g.service.add(b.item).success(function(){f.success(e.fetch(g.name+"_create_success")),history.go(-1)}).error(function(){f.error(e.fetch(g.name+"_create_error"))})}},delete b.actions.remove,b.types&&h(b.types)},a["abstract"].edit=function(b,c,d,e,f,g){function h(a){var b;for(b in a)"select"===a[b].value&&a[b].provider&&i(a[b],b)}function i(a,c){a.provider.getAll().success(function(a){b.types[c].options=j(a)}).error(console.error)}function j(a){var b={};return a.forEach(function(a){b[a.id]=a.title||a.name||"not found"}),b}a["abstract"].init(b,d,e,g),b.save={label:e.fetch("save"),handler:function(){g.service.save(g.id,b.item).success(function(){f.success(e.fetch(g.name+"_edit_success")),history.go(-1)}).error(function(){f.error(e.fetch(g.name+"_edit_error"))})}},g.service.getById(g.id).success(function(a){b.item=a,c.$broadcast("breadcrumb:add",{label:g.name,path:"/"+g.name}),c.$broadcast("breadcrumb:add",{label:"Edit "+(a.title||a.name||a.username)})}).error(function(a){console.log(a)}),b.types&&h(b.types)},a["abstract"].getAction=function(a){for(var b=["edit","remove","view","create","join","start"],c=b.length,d=0;c>d;d++)if(-1!==a.indexOf(b[d]))return b[d]},a["abstract"].init=function(a,b,c,d){a.id=d.id,a.fields=d.fields,a.path="#/"+d.name,a.item={},a.items=[],a.actions={},a.headers=[],a.types=d.types,a.fields.forEach(function(b){a.headers.push(c.fetch(b)),a.item[b]=""}),b.getAllowedActions(d.name).forEach(function(b){a.actions[b]={label:c.fetch(d.name+"_"+b)}})},a["abstract"].list=function(b,c,d,e,f){a["abstract"].init(b,d,e,f),b.headers.push(e.fetch("actions")),f.service[f.serviceMethod||"getAll"](f.serviceId).success(function(a){b.items=a,c.$broadcast("breadcrumb:add",{label:f.name})}).error(function(a){console.error(a)})},a["abstract"].remove=function(b,c,d,e,f,g){a["abstract"].init(b,d,e,g),b.confirmation={message:e.fetch(g.name+"_confirm_remove"),accept:e.fetch(g.name+"_accept_remove"),refuse:e.fetch(g.name+"_refuse_remove"),yes:function(){g.service.remove(g.id).success(function(){f.success(e.fetch(g.name+"_remove_success")),history.go(-1)}).error(function(){f.error(e.fetch(g.name+"_remove_error"))})},no:function(){history.go(-1)}},g.service.getById(g.id).success(function(a){b.item=a,c.$broadcast("breadcrumb:add",{label:g.name,path:"/"+g.name}),c.$broadcast("breadcrumb:add",{label:"Remove "+(a.title||a.name||a.username)})}).error(function(a){console.log(a)})},a["abstract"].router=function(b,c,d,e,f,g){var h={service:g.service,serviceMethod:g.serviceMethod,serviceId:g.serviceId,name:g.name,fields:g.fields.edit,types:g.types,id:g.id};g.id||"create"===g.action?a["abstract"][g.action]&&("create"===g.action&&(h.fields=g.fields.create),a["abstract"][g.action](b,c,d,e,f,h)):(h.fields=g.fields.list,a["abstract"].list(b,c,d,e,h))},a["abstract"].view=function(b,c,d,e,f,g){a["abstract"].init(b,d,e,g),g.service.getById(g.id).success(function(a){b.item=a,c.$broadcast("breadcrumb:add",{label:g.name,path:"/"+g.name}),c.$broadcast("breadcrumb:add",{label:a.title||a.name||a.username})}).error(function(a){console.log(a)})},a.breadcrumb=function(a,b){function c(){d=b.path(),a.crumbs=[],"/dashboard"!==d&&"/login"!==d&&a.crumbs.push({label:"Dashboard",path:"/dashboard"}),"/dashboard"===d&&a.crumbs.push({label:"Dashboard"})}var d=b.path();a.crumbs=[],c(),a.$on("$locationChangeSuccess",c),a.$on("breadcrumb:add",function(b,c){a.crumbs.push(c)})},a.breadcrumb.$inject=["$scope","$location"],a.dashboard=function(){},a.dashboard.$inject=["$scope","$rootScope","$injector"],a.login=function(a,b,c,d,e,f){a.username="",a.password="",a.errors={username:!1,password:!1},a.submit=function(){d.login(a.username,a.password).success(function(d){a.errors.username=!1,a.errors.password=!1,e.create(d),b.$broadcast(f.events.user.login),c.path("/dashboard")}).error(function(b){"PASSWORD"===b.error&&(a.errors.username=!1,a.errors.password=!0),"NOT_FOUND"===b.error&&(a.errors.username=!0,a.errors.password=!0)})}},a.login.$inject=["$scope","$rootScope","$location","users","session","constants"],a.main=function(){io.socket.on("hello",function(a){window.me=a})},a.main.$inject=[],a.sections=function(a,b,c,d,e){function f(){a.sections=[],g[d.getUserType()||3].forEach(function(b){a.sections.push({label:e.fetch(b),path:"/"+b})})}var g={1:["users"],2:["users"],3:["users"]};a.sections=[],f(),b.$on(c.events.user.login,function(){f()}),b.$on(c.events.user.logout,function(){a.sections=[]})},a.sections.$inject=["$scope","$rootScope","constants","session","i18n"],a.toasts=function(a,b,c){var d=3500,e=1e3;a.items=[],a.close=function(b){c.cancel(a.items[b].timeout),a.items[b].enable=!1,c(function(){a.items.splice(b,1)},e)},b.$on("toast",function(b,f){a.items.push(f),f.enable=!0,c(function(){f.enable=!1,c(function(){a.items.forEach(function(b,c){b===f&&a.items.splice(c,1)})},e)},d)})},a.toasts.$inject=["$scope","$rootScope","$timeout"],a.toolbar=function(a,b,c,d,e){var f=c.path().split("/");a.active=f[1],a.isCollapsed=!0,a.id=d.getId()||null,a.username=d.getUsername()||"",a.display=!1,a.logout=function(){d.destroy(),a.display=!1,a.username="",a.sections=[],c.path("/login"),b.$broadcast(e.events.user.logout)},b.$on(e.events.user.login,function(){a.display=!0,a.username=d.getUsername()})},a.toolbar.$inject=["$scope","$rootScope","$location","session","constants"],a.users=function(b,c,d,e,f,g,h,i){a["abstract"].router(b,c,g,f,h,{name:"users",service:i,id:e.id,action:a["abstract"].getAction(d.path()),fields:{edit:["username","user_type"],create:["username","password","user_type"],list:["username","user_type"]},types:{user_type:{value:"select",options:{1:f.fetch("admin"),2:f.fetch("moderator"),3:f.fetch("user")}}}})},a.users.$inject=["$scope","$rootScope","$location","$routeParams","i18n","permissions","toasts","users"],d.daysRender=function(){return{restrict:"A",link:function(a,b,c){var d,e={},f=[];try{e=JSON.parse(c.daysRender)}catch(g){}for(d in e)f.push('<span class="text-capitalize">'+d+"</span>");b.html(f.join(", "))}}},d.dayspicker=function(){function a(a,d){var e=d.value?JSON.parse(d.value):{},g=angular.element(d).parents()[0].getElementsByTagName("label");angular.element(g).remove(),f.forEach(function(b){var f=document.createElement("input"),g=document.createElement("label");g.className="text-capitalize text-center margin-right",f.className="checkbox",f.style.margin="0 auto",f.type="checkbox",f.name="days[]",f.value=b,f.checked=e[b],angular.element(g).text(b).append(f).on("click",function(){c(this,d)}),a.append(g)}),b(d)}function b(a){var b=angular.element(a).parents()[0].getElementsByTagName("label"),c=a.value?JSON.parse(a.value):{};angular.forEach(b,function(a){var b=a.getElementsByTagName("input")[0];c[b.value]&&b.setAttribute("checked","checked")})}function c(a,b){var c=b.value?JSON.parse(b.value):{};a.type||(a=a.getElementsByTagName("input")[0]),a.checked?c[a.value]=!0:c[a.value]&&delete c[a.value],b.value=JSON.stringify(c),e.item.days=b.value}function d(a){var b=a[0].getElementsByTagName("input");angular.forEach(b,function(a){angular.element(a).off("click")})}var e,f=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];return{restrict:"AE",link:function(b,c){var f=c.children()[0];e=b,b.$watch("item.days",function(b){f.value=b,a(c,f)}),b.$on("$destroy",function(){d(c)})}}},d.dayspicker.$inject=[],c["en-GB"]={actions:"Actions",save:"Save",create:"Create",users:"Users",users_add:"Add a new user",users_remove:"Remove user",users_edit:"Edit user",users_view:"View user",users_confirm_remove:"Are you sure you want to delete this user?",users_accept_remove:"Accept",users_refuse_remove:"Cancel",users_edit_success:"User edited with success",users_edit_error:"Failed to edit the user",users_create_success:"User created with success",users_create_error:"Failed to create the user",users_remove_success:"User removed with success",users_remove_error:"Failed to remove the user",user_type:"User type",username:"Username",password:"Password",admin:"Admin",moderator:"Moderator",user:"User",name:"Name",title:"Title",start_date:"Start date",start_time:"Start time",user_id:"User id",published:"Publish",registrations:"Registrations",dashboard:"Dashboard",description:"Description",days:"Days",times:"Times",calendar:"Calendar",message:"Message",createdAt:"Created at",updatedAt:"Updated at"},b["abstract"].api=function(a,b){return{raw:function(b){return a.query(b)},getAll:function(){return a.query("/"+b)},getById:function(c){return a.query("/"+b+"/"+c)},add:function(c){return a.query("/"+b+"/create",c)},save:function(c,d){return a.query("/"+b+"/update/"+c,d)},remove:function(c){return a.query("/"+b+"/destroy/"+c)},getOverview:function(c){return a.query("/"+b+"/overview"+(c?"?id="+c:""))}}},b.constants=function(){return{events:{user:{login:"user:login",logout:"user:logout"},access:{forbidden:"access:forbidden"}},i18n:{not_found:"NOT_FOUND:i18n:"}}},b.i18n=function(a){var b="en-GB",d=b;return{fetch:function(e){return c[d][e]||c[b][e]||a.i18n.not_found+e}}},b.i18n.$inject=["constants"],b.permissions=function(a){var b={1:"school",2:"teacher",3:"student"},c={school:{users:["add","edit","remove","view"],activities:["add","edit","remove","view"],subjects:["add","edit","remove","view"],news:["add","edit","remove","view"],lessons:["view"],questions:["view"],answers:["view"],logs:["view"]},teacher:{lessons:["add","edit","remove","view","start","results"],activities:["view"],news:["view"],questions:["add","edit","remove","view"],answers:["add","edit","remove","view"]},student:{lessons:["view","join","results"],news:["view"],activities:["view","register"]}};return{getAllowedSections:function(){return c[b[a.getUserType()]]||{}},getAllowedActions:function(d){var e=c[b[a.getUserType()]];return e&&e[d]?e[d]||[]:[]},can:function(d,e){var f=!1,g=c[b[a.getUserType()]];return g[e]&&(f=-1!==g[e].indexOf(d)),f}}},b.permissions.$inject=["session"],b.restful=function(a){function b(b,d){return a({url:c+b,params:d,method:"GET",widthCredentials:!0})}var c=e.app.getServerUrl();return{query:b}},b.restful.$inject=["$http"],b.session=function(a){function b(b){c=b.id,d=b.username,e=b.user_type,a.put("user",b)}var c,d,e,f=a.get("user");return f&&b(f),{getId:function(){return parseInt(c)},getUsername:function(){return d},getUserType:function(){return e},create:b,destroy:function(){c=null,d=null,e=null,a.put("user",null)}}},b.session.$inject=["$cookieStore"],b.toasts=function(a){function b(b,c){a.$emit("toast",{type:b,message:c})}return{message:function(a){b("primary",a)},info:function(a){b("info",a)},success:function(a){b("success",a)},warning:function(a){b("warning",a)},error:function(a){b("danger",a)}}},b.toasts.$inject=["$rootScope"],b.users=function(a){var c=b["abstract"].api(a,"users");return c.login=function(b,c){return a.query("/users/login",{username:b,password:c})},c.logout=function(){return a.query("/users/logout")},c},b.users.$inject=["restful"],angular.module(e.app.name,e.app.modules).config(e.routes).run(e.access),function(b,c){for(c in a)"abstract"!==c&&b.controller(c,a[c])}(angular.module(e.app.name+".controllers",[e.app.name+".services"])),function(a,b){for(b in d)"abstract"!==b&&a.directive(b,d[b])}(angular.module(e.app.name+".directives",[])),function(a,c){for(c in b)"abstract"!==c&&a.factory(c,b[c])}(angular.module(e.app.name+".services",[]))}();